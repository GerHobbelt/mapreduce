# MRMPI test script with new syntax

variable p equal nprocs
variable t equal time
variable nkv equal mr(nkv)
variable nkmv equal mr(nkmv)

mr = mrmpi()
mr.timer(1)
mr.verbosity(2)

gen = map.gen_kv(100000,12345,value,str,3,32,a,z,key,str,3,3,a,z)
scmp = compare.strcmp()

variable tstart equal $t
mr.map(1,gen)
variable tstop equal $t
variable n equal ${nkv}

mr2 = mr.copy()

mr.collate()
variable nm equal ${nkmv}
mr2.sort_keys(scmp)

mr.delete()
mr2.delete()

variable delta equal v_tstop-v_tstart
print "Generation time = ${delta} (secs) on $p procs for $n ${nm} KVs"

